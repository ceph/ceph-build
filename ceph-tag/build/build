#!/bin/bash

set -ex

if [ "$TAG" = false ] ; then
    echo "Assuming tagging process has succeeded before because TAG was set to false"
    exit 0
fi

# the following two methods exist in scripts/build_utils.sh
pkgs=( "ansible" )
install_python_packages $TEMPVENV "pkgs[@]"

# run ansible to do all the tagging and release specifying
# a local connection and 'localhost' as the host where to execute
cd "$WORKSPACE/ceph-build/ansible/"
$VENV/ansible-playbook -i "localhost," -c local release.yml --extra-vars="version=$VERSION branch=$BRANCH force_version=$FORCE_VERSION release=stable clean=true project=ceph"
